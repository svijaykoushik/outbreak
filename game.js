var player,playerRight,aliens,bullets,game=new Phaser.Game(800,600,Phaser.AUTO,"phaser-example",{preload:preload,create:create,update:update,render:render});function preload(){game.load.image("bullet","assets/player_bullet.jpg"),game.load.image("enemyBullet","assets/enemy_bullet.jpg"),game.load.image("virus","assets/enemy.png"),game.load.spritesheet("player","assets/player.png",128,128,13),game.load.spritesheet("buttons","assets/buttons.png",110,110,3),game.load.image("background","assets/background.jpg"),0==game.device.desktop&&(game.scale.scaleMode=Phaser.ScaleManager.EXACT_FIT),game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0}var cursors,fireButton,explosions,background,scoreText,lives,enemyBullet,stateText,lifeSprite,virtualFireButton,virtualFireButtonPt,virtualLeftButton,virtualLeftButtonPt,virtualRightButton,virtualRightButtonPt,isVirtualLeftDown,isVirtualRightDown,isVirtualFireDown,btnRadius,bulletTime=0,score=0,scoreString="",firingTimer=0,livingEnemies=[];function create(){game.physics.startSystem(Phaser.Physics.ARCADE),background=game.add.tileSprite(0,0,800,600,"background"),(bullets=game.add.group()).enableBody=!0,bullets.physicsBodyType=Phaser.Physics.ARCADE,bullets.createMultiple(30,"bullet"),bullets.setAll("anchor.x",.5),bullets.setAll("anchor.y",1),bullets.setAll("outOfBoundsKill",!0),bullets.setAll("checkWorldBounds",!0),enemyBullets=game.add.group(),enemyBullets.enableBody=!0,enemyBullets.physicsBodyType=Phaser.Physics.ARCADE,enemyBullets.createMultiple(30,"enemyBullet"),enemyBullets.setAll("anchor.x",.5),enemyBullets.setAll("anchor.y",1),enemyBullets.setAll("outOfBoundsKill",!0),enemyBullets.setAll("checkWorldBounds",!0),(player=game.add.sprite(400,500,"player")).anchor.setTo(.5,.5),player.frame=6,player.animations.add("left",[0,1,2,3,4,5],15,!0),player.animations.add("right",[7,8,9,10,11,12],15,!0),game.physics.enable(player,Phaser.Physics.ARCADE),player.body.setSize(110,110),(aliens=game.add.group()).enableBody=!0,aliens.physicsBodyType=Phaser.Physics.ARCADE,createAliens(),(virtualFireButton=game.add.sprite(680,450,"buttons",0)).alpha=.4,virtualFireButtonPt=new Phaser.Point(680,450),(virtualLeftButton=game.add.sprite(10,450,"buttons",1)).alpha=.4,virtualLeftButtonPt=new Phaser.Point(10,450),(virtualRightButton=game.add.sprite(125,450,"buttons",2)).alpha=.4,virtualRightButtonPt=new Phaser.Point(125,450),btnRadius=110,console.info(game.input.pointers),scoreString="Score : ",scoreText=game.add.text(10,10,scoreString+score,{font:"34px Arial",fill:"#000"}),lives=game.add.group(),game.add.text(game.world.width-100,10,"Lives : ",{font:"34px Arial",fill:"#000"}),(stateText=game.add.text(game.world.centerX,game.world.centerY," ",{font:"84px Arial",fill:"#000"})).anchor.setTo(.5,.5),stateText.visible=!1;for(var e=0;e<3;e++){var t=lives.create(game.world.width-100+30*e,60,"player");t.scale.setTo(.25,.25),t.anchor.setTo(.5,.5),t.angle=90}cursors=game.input.keyboard.createCursorKeys(),fireButton=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)}function isPointerOverButton(e,t){var i=e.distance(t.position);return!!(t.isDown&&i<btnRadius)}function createAliens(){for(var e=0;e<4;e++)for(var t=0;t<10;t++){var i=aliens.create(52*t,52*e,"virus");i.anchor.setTo(.5,.5),i.body.moves=!1}aliens.x=100,aliens.y=50,game.add.tween(aliens).to({x:200},2e3,Phaser.Easing.Linear.None,!0,0,1e3,!0).onLoop.add(descend,this)}function setupInvader(e){e.anchor.x=.5,e.anchor.y=.5}function descend(){aliens.y+=10}function moveLeft(){player.body.velocity.x=-200,player.play("left")}function moveRight(){player.body.velocity.x=200,player.play("right")}function resetVirtualButtons(){isVirtualRightDown=isVirtualLeftDown=isVirtualFireDown=!1}function update(){background.tilePosition.y+=2,resetVirtualButtons(),player.alive&&(game.input.pointers.forEach(function(e){isPointerOverButton(virtualFireButtonPt,e)?isVirtualFireDown=!0:isPointerOverButton(virtualLeftButtonPt,e)?isVirtualLeftDown=!0:isPointerOverButton(virtualRightButtonPt,e)&&(isVirtualRightDown=!0)}),player.body.velocity.setTo(0,0),cursors.left.isDown||isPointerOverButton(virtualLeftButtonPt,game.input.mousePointer)||isVirtualLeftDown?moveLeft():cursors.right.isDown||isPointerOverButton(virtualRightButtonPt,game.input.mousePointer)||isVirtualRightDown?moveRight():(player.animations.stop(),player.frame=6),(fireButton.isDown||isPointerOverButton(virtualFireButtonPt,game.input.mousePointer)||isVirtualFireDown)&&(fireBullet(),player.frame=6),game.time.now>firingTimer&&enemyFires(),game.physics.arcade.overlap(bullets,aliens,collisionHandler,null,this),game.physics.arcade.overlap(enemyBullets,player,enemyHitsPlayer,null,this))}function render(){game.input.pointers.forEach(function(e){game.debug.pointer(e)}),game.debug.pointer(game.input.mousePointer)}function collisionHandler(e,t){e.kill(),t.kill(),score+=20,scoreText.text=scoreString+score,0==aliens.countLiving()&&(score+=1e3,scoreText.text=scoreString+score,enemyBullets.callAll("kill",this),stateText.text=" You Won, \n Click to restart",stateText.visible=!0,game.input.onTap.addOnce(restart,this))}function enemyHitsPlayer(e,t){t.kill(),live=lives.getFirstAlive(),live&&live.kill(),lives.countLiving()<1&&(e.kill(),enemyBullets.callAll("kill"),stateText.text=" GAME OVER \n Click to restart",stateText.visible=!0,game.input.onTap.addOnce(restart,this))}function enemyFires(){if(enemyBullet=enemyBullets.getFirstExists(!1),livingEnemies.length=0,aliens.forEachAlive(function(e){livingEnemies.push(e)}),enemyBullet&&0<livingEnemies.length){var e=game.rnd.integerInRange(0,livingEnemies.length-1),t=livingEnemies[e];enemyBullet.reset(t.body.x,t.body.y),game.physics.arcade.moveToObject(enemyBullet,player,120),firingTimer=game.time.now+2e3}}function fireBullet(){game.time.now>bulletTime&&(bullet=bullets.getFirstExists(!1),bullet&&(bullet.reset(player.x+7,player.y-28),bullet.body.velocity.y=-400,bulletTime=game.time.now+200))}function resetBullet(e){e.kill()}function restart(){lives.callAll("revive"),aliens.removeAll(),createAliens(),player.revive(),stateText.visible=!1}